[["index.html", "Working with Census Data in R 1 Introduction", " Working with Census Data in R Aditya Ranganath 2022-01-22 1 Introduction "],["preliminaries.html", "2 Preliminaries", " 2 Preliminaries library(tidycensus) library(tidyverse) library(knitr) library(psych) library(stringr) library(kableExtra) library(sf) library(tmap) "],["basic-data-retrieval.html", "3 Basic Data Retrieval 3.1 Load table of variables 3.2 Query the census API, and retrieve data using tidycensus 3.3 Modify a census API call by altering arguments to the “get_decennial” function", " 3 Basic Data Retrieval 3.1 Load table of variables We begin by loading a table of decennial census variables, and assigning it to an object named decennial_variables: decennial_variables&lt;-load_variables(2010, &quot;sf1&quot;) We can print this table to the console by simply printing the object name, decennial_variables: # Print table of 2010 decennial variables to console decennial_variables ## # A tibble: 8,959 x 3 ## name label concept ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 H001001 Total HOUSING UNITS ## 2 H002001 Total URBAN AND RURAL ## 3 H002002 Total!!Urban URBAN AND RURAL ## 4 H002003 Total!!Urban!!Inside urbanized areas URBAN AND RURAL ## 5 H002004 Total!!Urban!!Inside urban clusters URBAN AND RURAL ## 6 H002005 Total!!Rural URBAN AND RURAL ## 7 H002006 Total!!Not defined for this file URBAN AND RURAL ## 8 H003001 Total OCCUPANCY STATUS ## 9 H003002 Total!!Occupied OCCUPANCY STATUS ## 10 H003003 Total!!Vacant OCCUPANCY STATUS ## # … with 8,949 more rows To view this table in R Studio’s data viewer, pass the object to the View function: View(decennial_variables) When the data is open in the R Studio data viewer, it will look something like this: Figure 3.1: Table of 2010 census variable descriptions and codes 3.2 Query the census API, and retrieve data using tidycensus Now, let’s generate a table of population by state, based on the 2010 decennial census, and assign this new dataset to an object named state_population_2010: state_population_2010&lt;-get_decennial(geography = &quot;state&quot;, variables = &quot;P001001&quot;, year = 2010) ## Getting data from the 2010 decennial Census ## Using Census Summary File 1 As with our table of variable descriptions (decennial_variables), we can view the data by typing the object name, which prints its contents to the console: state_population_2010 ## # A tibble: 52 x 4 ## GEOID NAME variable value ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 01 Alabama P001001 4779736 ## 2 02 Alaska P001001 710231 ## 3 04 Arizona P001001 6392017 ## 4 05 Arkansas P001001 2915918 ## 5 06 California P001001 37253956 ## 6 22 Louisiana P001001 4533372 ## 7 21 Kentucky P001001 4339367 ## 8 08 Colorado P001001 5029196 ## 9 09 Connecticut P001001 3574097 ## 10 10 Delaware P001001 897934 ## # … with 42 more rows Recall that we can also bring up the data in the R Studio data viewer using the View function: View(state_population_2010) GEOID NAME variable value 01 Alabama P001001 4779736 02 Alaska P001001 710231 04 Arizona P001001 6392017 05 Arkansas P001001 2915918 06 California P001001 37253956 22 Louisiana P001001 4533372 3.3 Modify a census API call by altering arguments to the “get_decennial” function Let’s say that instead of a dataset that contains the population for each state (based on the 2010) census, we want a dataset that contains the population for each county in the state of Colorado. We can generate this county-level dataset by simply changing the geography argument in the get_decennial function, and specifying state=\"CO\". We’ll assign this county-level population dataset for Colorado to a new object called CO_county_population_2010: # Generate dataset with information on population by county in Colorado, and assign to an object named &quot;CO_county_population_2010&quot; CO_county_population_2010&lt;-get_decennial(geography = &quot;county&quot;, state=&quot;CO&quot;, variables = &quot;P001001&quot;, year = 2010) # View dataset View(CO_county_population_2010) GEOID NAME variable value 08023 Costilla County, Colorado P001001 3524 08025 Crowley County, Colorado P001001 5823 08027 Custer County, Colorado P001001 4255 08029 Delta County, Colorado P001001 30952 08031 Denver County, Colorado P001001 600158 08035 Douglas County, Colorado P001001 285465 "],["basic-data-cleaning-and-manipulation-with-dplyr.html", "4 Basic data cleaning and manipulation with dplyr 4.1 Renaming and deleting columns 4.2 Modifying columns 4.3 Subsetting Data 4.4 Creating new variables", " 4 Basic data cleaning and manipulation with dplyr Once data has been pulled into R Studio via tidycensus, it’s possible to work with data using the entire suite of data analysis tools available through the tidyverse. Among other things, we can use tidyverse tools to clean up, modify, query, and augment the census datasets that we retrieve using tidycensus. 4.1 Renaming and deleting columns 4.1.1 The rename and select functions Let’s clean up the dataset of Colorado’s 2010 population distribution with respect to counties that we just created in the previous section (CO_county_population_2010). As a reminder, the first few rows of that dataset look like this: View(CO_county_population_2010) kable(head(CO_county_population_2010, n=6)) GEOID NAME variable value 08023 Costilla County, Colorado P001001 3524 08025 Crowley County, Colorado P001001 5823 08027 Custer County, Colorado P001001 4255 08029 Delta County, Colorado P001001 30952 08031 Denver County, Colorado P001001 600158 08035 Douglas County, Colorado P001001 285465 Let’s remove the “variable” field, and rename the “value” field as “Population”. We can perform these operations by using functions from the dplyr package, which is a part of the tidyverse. We can use the select function to remove the “variable” field, and the rename function to rename the name of the field containing the population data from “value” to “population”. We’ll use the pipe operator (%&gt;%) to chain together these functions, which allows us to perform both of these cleaning operations in one block of code; we’ll assign the revised dataset to a new object named CO_county_population_2010_cleaned: # Takes &quot;CO_county_population_2010&quot;, deletes the &quot;variable&quot; column, renames the &quot;value&quot; column as &quot;population&quot;, and assigns this modified dataset to a new object names &quot;CO_county_population_2010_cleaned&quot; CO_county_population_2010_cleaned&lt;-CO_county_population_2010 %&gt;% select(-variable) %&gt;% rename(population=value) Let’s view the dataset to ensure that these changes have been implemented: View(CO_county_population_2010_cleaned) GEOID NAME population 08023 Costilla County, Colorado 3524 08025 Crowley County, Colorado 5823 08027 Custer County, Colorado 4255 08029 Delta County, Colorado 30952 08031 Denver County, Colorado 600158 08035 Douglas County, Colorado 285465 Note that the select function can either be used to directly delete columns from a dataset (if these columns are preceded by a -) or alternatively, to designate the columns to keep (which will delete the residual columns). So, for example, the following syntax would also effectively delete the variable column, and rename the value column: # Takes &quot;CO_county_population_2010&quot;, deletes the &quot;variable&quot; column (using slightly different syntax than above), renames the &quot;value&quot; column as &quot;population&quot;, and assigns this modified dataset to a new object names &quot;CO_county_population_2010_cleaned_alternate&quot; CO_county_population_2010_cleaned_alternate&lt;-CO_county_population_2010 %&gt;% select(GEOID, NAME, value) %&gt;% rename(population=value) Let’s check to make sure that CO_county_population_cleaned_alternate looks the same as CO_county_population_cleaned above: View(CO_county_population_2010_cleaned_alternate) GEOID NAME population 08023 Costilla County, Colorado 3524 08025 Crowley County, Colorado 5823 08027 Custer County, Colorado 4255 08029 Delta County, Colorado 30952 08031 Denver County, Colorado 600158 08035 Douglas County, Colorado 285465 4.2 Modifying columns 4.2.1 Columns and string operations Note that the “Name” column in our cleaned county-level dataset of the Colorado population contains names in the format “ County, Colorado”. What if we want to edit this, such that we replace the “NAME” column with a new column named “County”, which contains simply the name of the county (i.e. &lt;“County Name”&gt; instead of &lt;“County Name&gt; County, Colorado”&gt;)? To do so, we can use the mutate function to create a new column named “County”, and then populate this column with the string that results from removing “County, Colorado” from the “NAME” column; then, we can go ahead and remove the “NAME” column. Below, instead of assigning this modified dataset to a new object, we’ll simply assign it back to CO_county_population_2010_cleaned, which overwrites that object’s existing contents with these changes: # Take the &quot;CO_county_population_2010_cleaned&quot; dataset, create a new variable named &quot;County&quot; that takes the information in the &quot;NAME&quot; column and removes the part of the string that contains &quot;County, Colorado&quot;, and then remove the now superfluous &quot;NAME&quot; column CO_county_population_2010_cleaned&lt;-CO_county_population_2010_cleaned %&gt;% mutate(County=str_remove(NAME, &quot; County, Colorado&quot;)) %&gt;% select(-NAME) # View &quot;CO_county_population_2010_cleaned&quot; (Note that only the first six records are printed in this guide) View(CO_county_population_2010_cleaned) GEOID population County 08023 3524 Costilla 08025 5823 Crowley 08027 4255 Custer 08029 30952 Delta 08031 600158 Denver 08035 285465 Douglas 4.2.2 The relocate function It’s worth noting that we can use the relocate function to reorder a dataset’s columns to our specifications. For example, note that currently, the population column is sandwiched between “GEOID” and “County”; what if we prefer that the “population” column is the last column in the dataset? We can change the column order using the relocate function, and specify the desired relative position of a given column using either the .before or .after argument: CO_county_population_2010_cleaned&lt;-CO_county_population_2010_cleaned %&gt;% relocate(population, .after=County) View(CO_county_population_2010_cleaned) GEOID County population 08023 Costilla 3524 08025 Crowley 5823 08027 Custer 4255 08029 Delta 30952 08031 Denver 600158 08035 Douglas 285465 Note that if neither the .before nor .after arguments are specified within the relocate function, the column that is passed to relocate will automatically be moved to the front of the dataset (i.e. it will be the first column). 4.3 Subsetting Data 4.3.1 The filter function dplyr also allows us to easily subset census data retrieved from tidycensus. Let’s say, for example, that we want to select only those counties in CO_county_population_2010_cleaned that have a population greater than 100,000. To do so, we can specify this condition with the appropriate logical operator within the filter function. We’ll assign this subsetted data to a new object named CO_large_counties: CO_large_counties&lt;-CO_county_population_2010_cleaned %&gt;% filter(population&gt;100000) Now, let’s view our newly created table of Colorado counties with a population of greater than 100,000: View(CO_large_counties) GEOID County population 08031 Denver 600158 08035 Douglas 285465 08041 El Paso 622263 08069 Larimer 299630 08059 Jefferson 534543 08077 Mesa 146723 08101 Pueblo 159063 08123 Weld 252825 08001 Adams 441603 08005 Arapahoe 572003 08013 Boulder 294567 Note that the table is not arranged in order, with respect to the population. Let’s reorder the dataset’s rows, in descending order with respect to the population variable (such that the most populous county appears in the first row): CO_large_counties&lt;-CO_large_counties %&gt;% arrange(desc(population)) View(CO_large_counties) GEOID County population 08041 El Paso 622263 08031 Denver 600158 08005 Arapahoe 572003 08059 Jefferson 534543 08001 Adams 441603 08069 Larimer 299630 08013 Boulder 294567 08035 Douglas 285465 08123 Weld 252825 08101 Pueblo 159063 08077 Mesa 146723 If we want to arrange the dataset in ascending order with respect to the population (such that the least populous county appears on top), we can use the following: CO_large_counties&lt;-CO_large_counties %&gt;% arrange(population) View(CO_large_counties) GEOID County population 08077 Mesa 146723 08101 Pueblo 159063 08123 Weld 252825 08035 Douglas 285465 08013 Boulder 294567 08069 Larimer 299630 08001 Adams 441603 08059 Jefferson 534543 08005 Arapahoe 572003 08031 Denver 600158 08041 El Paso 622263 It is also possible to filter based on text; for example, if we want to extract the record for Denver, we could use the following (note the double equal sign in the expression): CO_large_counties %&gt;% filter(County==&quot;Denver&quot;) ## # A tibble: 1 x 3 ## GEOID County population ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 08031 Denver 600158 Note that above, we didn’t assign this subsetted record to it’s own object, but we could have easily done so. Below, let’s subset Denver and Boulder counties, and assign these records to a new object, named denver_boulder: denver_boulder&lt;-CO_large_counties %&gt;% filter(County==&quot;Denver&quot;|County==&quot;Boulder&quot;) View(denver_boulder) kable(denver_boulder) GEOID County population 08013 Boulder 294567 08031 Denver 600158 Note the syntax above; the code that reads filter(County==\"Denver\"|County==\"Boulder) specifies that we want to pull out all records where the “County” column takes on the value “Denver” OR (denoted by the |) “Boulder”. While filter is the most common function used to subset data according to specified criteria, there are others that come in handy as well. 4.3.2 slice functions It is often useful to extract rows with particularly high or low values for a given variable. This is where the slice functions of dplyr can come in handy. Let’s say we want to extract the county with the largest population in the CO_county_population_2010_cleaned dataset; we can do so by passing the “population” variable as an argument to the slice_max function: CO_county_population_2010_cleaned %&gt;% slice_max(population) ## # A tibble: 1 x 3 ## GEOID County population ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 08041 El Paso 622263 If we don’t want the single largest county by population, it is easy to extract records with the “n” largest values of a variable by specifying n as an argument. For example, if we wanted the four most populous counties, we would specify n=4 after the population argument: CO_county_population_2010_cleaned %&gt;% slice_max(population, n=4) ## # A tibble: 4 x 3 ## GEOID County population ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 08041 El Paso 622263 ## 2 08031 Denver 600158 ## 3 08005 Arapahoe 572003 ## 4 08059 Jefferson 534543 The slice_min function is analogous to the slice_max function, but extracts the rows associated with the “n” smallest values of a variable. For example, the code below extracts the 8 smallest counties by population (note that unlike in the slice_max example, we’ll assign the resulting subset to a new object, named CO_counties_8smallest): CO_counties_8smallest&lt;-CO_county_population_2010_cleaned %&gt;% slice_min(population, n=8) View(CO_counties_8smallest) GEOID County population 08111 San Juan 699 08079 Mineral 712 08053 Hinsdale 843 08057 Jackson 1394 08061 Kiowa 1398 08017 Cheyenne 1836 08033 Dolores 2064 08115 Sedgwick 2379 4.4 Creating new variables After retrieving a census dataset, we may want to recode variables, or generate new variables based on existing variables. For instance, perhaps we want to create a new qualitative indicator variable named “Population_Category” in the CO_county_population_2010_cleaned dataset that is coded as “High Population” if a county’s population is greater than 100,000; coded as “Medium Population” if it is between 10,000 and 100,000; and “Low Population” if it is below 10,000. CO_county_population_2010_cleaned&lt;- CO_county_population_2010_cleaned %&gt;% mutate(Population_Category=case_when(population&gt;=100000~&quot;High Population&quot;, population&lt;100000 &amp; population&gt;=10000~&quot;Medium Population&quot;, population&lt;10000~&quot;Low Population&quot;)) View(CO_county_population_2010_cleaned) GEOID County population Population_Category 08023 Costilla 3524 Low Population 08025 Crowley 5823 Low Population 08027 Custer 4255 Low Population 08029 Delta 30952 Medium Population 08031 Denver 600158 High Population 08035 Douglas 285465 High Population 08033 Dolores 2064 Low Population 08049 Grand 14843 Medium Population 08039 Elbert 23086 Medium Population 08041 El Paso 622263 High Population 08043 Fremont 46824 Medium Population 08045 Garfield 56389 Medium Population 08047 Gilpin 5441 Low Population 08069 Larimer 299630 High Population 08051 Gunnison 15324 Medium Population 08053 Hinsdale 843 Low Population 08055 Huerfano 6711 Low Population 08057 Jackson 1394 Low Population 08059 Jefferson 534543 High Population 08061 Kiowa 1398 Low Population 08063 Kit Carson 8270 Low Population 08065 Lake 7310 Low Population 08071 Las Animas 15507 Medium Population 08067 La Plata 51334 Medium Population 08087 Morgan 28159 Medium Population 08073 Lincoln 5467 Low Population 08075 Logan 22709 Medium Population 08077 Mesa 146723 High Population 08079 Mineral 712 Low Population 08081 Moffat 13795 Medium Population 08083 Montezuma 25535 Medium Population 08085 Montrose 41276 Medium Population 08099 Prowers 12551 Medium Population 08089 Otero 18831 Medium Population 08091 Ouray 4436 Low Population 08093 Park 16206 Medium Population 08095 Phillips 4442 Low Population 08097 Pitkin 17148 Medium Population 08111 San Juan 699 Low Population 08107 Routt 23509 Medium Population 08109 Saguache 6108 Low Population 08101 Pueblo 159063 High Population 08103 Rio Blanco 6666 Low Population 08105 Rio Grande 11982 Medium Population 08113 San Miguel 7359 Low Population 08115 Sedgwick 2379 Low Population 08117 Summit 27994 Medium Population 08119 Teller 23350 Medium Population 08121 Washington 4814 Low Population 08123 Weld 252825 High Population 08125 Yuma 10043 Medium Population 08011 Bent 6499 Low Population 08001 Adams 441603 High Population 08005 Arapahoe 572003 High Population 08007 Archuleta 12084 Medium Population 08009 Baca 3788 Low Population 08003 Alamosa 15445 Medium Population 08021 Conejos 8256 Low Population 08013 Boulder 294567 High Population 08014 Broomfield 55889 Medium Population 08015 Chaffee 17809 Medium Population 08017 Cheyenne 1836 Low Population 08019 Clear Creek 9088 Low Population 08037 Eagle 52197 Medium Population sum(CO_county_population_2010_cleaned$population) ## [1] 5029196 CO_county_population_2010_cleaned&lt;-CO_county_population_2010_cleaned %&gt;% mutate(county_population_concentration=((population/5029196)*100)) View(CO_county_population_2010_cleaned) GEOID County population Population_Category county_population_concentration 08023 Costilla 3524 Low Population 0.0700708 08025 Crowley 5823 Low Population 0.1157839 08027 Custer 4255 Low Population 0.0846060 08029 Delta 30952 Medium Population 0.6154463 08031 Denver 600158 High Population 11.9334780 08035 Douglas 285465 High Population 5.6761558 08033 Dolores 2064 Low Population 0.0410404 08049 Grand 14843 Medium Population 0.2951366 08039 Elbert 23086 Medium Population 0.4590396 08041 El Paso 622263 High Population 12.3730115 08043 Fremont 46824 Medium Population 0.9310435 08045 Garfield 56389 Medium Population 1.1212329 08047 Gilpin 5441 Low Population 0.1081883 08069 Larimer 299630 High Population 5.9578111 08051 Gunnison 15324 Medium Population 0.3047008 08053 Hinsdale 843 Low Population 0.0167621 08055 Huerfano 6711 Low Population 0.1334408 08057 Jackson 1394 Low Population 0.0277181 08059 Jefferson 534543 High Population 10.6287963 08061 Kiowa 1398 Low Population 0.0277977 08063 Kit Carson 8270 Low Population 0.1644398 08065 Lake 7310 Low Population 0.1453513 08071 Las Animas 15507 Medium Population 0.3083395 08067 La Plata 51334 Medium Population 1.0207198 08087 Morgan 28159 Medium Population 0.5599106 08073 Lincoln 5467 Low Population 0.1087052 08075 Logan 22709 Medium Population 0.4515433 08077 Mesa 146723 High Population 2.9174246 08079 Mineral 712 Low Population 0.0141573 08081 Moffat 13795 Medium Population 0.2742983 08083 Montezuma 25535 Medium Population 0.5077352 08085 Montrose 41276 Medium Population 0.8207276 08099 Prowers 12551 Medium Population 0.2495628 08089 Otero 18831 Medium Population 0.3744336 08091 Ouray 4436 Low Population 0.0882050 08093 Park 16206 Medium Population 0.3222384 08095 Phillips 4442 Low Population 0.0883243 08097 Pitkin 17148 Medium Population 0.3409690 08111 San Juan 699 Low Population 0.0138988 08107 Routt 23509 Medium Population 0.4674505 08109 Saguache 6108 Low Population 0.1214508 08101 Pueblo 159063 High Population 3.1627918 08103 Rio Blanco 6666 Low Population 0.1325460 08105 Rio Grande 11982 Medium Population 0.2382488 08113 San Miguel 7359 Low Population 0.1463256 08115 Sedgwick 2379 Low Population 0.0473038 08117 Summit 27994 Medium Population 0.5566297 08119 Teller 23350 Medium Population 0.4642889 08121 Washington 4814 Low Population 0.0957211 08123 Weld 252825 High Population 5.0271455 08125 Yuma 10043 Medium Population 0.1996939 08011 Bent 6499 Low Population 0.1292254 08001 Adams 441603 High Population 8.7807872 08005 Arapahoe 572003 High Population 11.3736470 08007 Archuleta 12084 Medium Population 0.2402770 08009 Baca 3788 Low Population 0.0753202 08003 Alamosa 15445 Medium Population 0.3071067 08021 Conejos 8256 Low Population 0.1641614 08013 Boulder 294567 High Population 5.8571390 08014 Broomfield 55889 Medium Population 1.1112909 08015 Chaffee 17809 Medium Population 0.3541123 08017 Cheyenne 1836 Low Population 0.0365068 08019 Clear Creek 9088 Low Population 0.1807048 08037 Eagle 52197 Medium Population 1.0378796 "],["grouping-operations-and-summary-statistics.html", "5 Grouping operations and summary statistics 5.1 Aggregate summary statistics 5.2 Summary statistics by group", " 5 Grouping operations and summary statistics 5.1 Aggregate summary statistics usa_counties_total_rural&lt;-get_decennial(geography = &quot;county&quot;, variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year = 2010) %&gt;% rename(total_population=P001001, rural_population=P002005) View(usa_counties_total_rural) GEOID NAME total_population rural_population 05131 Sebastian County, Arkansas 125744 26170 05133 Sevier County, Arkansas 17058 10849 05135 Sharp County, Arkansas 17264 13821 05137 Stone County, Arkansas 12394 12394 05139 Union County, Arkansas 41639 22695 05141 Van Buren County, Arkansas 17295 17295 usa_counties_summary&lt;-usa_counties_total_rural %&gt;% select(total_population, rural_population) %&gt;% describe() %&gt;% as_tibble(rownames=&quot;variable&quot;) usa_counties_summary ## # A tibble: 2 x 14 ## variable vars n mean sd median trimmed mad min max range skew kurtosis se ## &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 total_popula… 1 3221 97011. 309299. 26076 41435. 27335. 82 9.82e6 9.82e6 14.5 353. 5450. ## 2 rural_popula… 2 3221 18542. 16651. 13878 15948. 12577. 0 1.47e5 1.47e5 1.79 4.66 293. variable vars n mean sd median trimmed mad min max range skew kurtosis se total_population 1 3221 97010.66 309298.78 26076 41434.81 27334.7 82 9818605 9818523 14.502652 352.530688 5449.8287 rural_population 2 3221 18542.32 16651.25 13878 15948.20 12576.9 0 146856 146856 1.792136 4.659721 293.3941 usa_counties_summary&lt;-usa_counties_summary %&gt;% select(variable, n, mean, sd, median, , min, max, range) variable n mean sd median min max range total_population 3221 97010.66 309298.78 26076 82 9818605 9818523 rural_population 3221 18542.32 16651.25 13878 0 146856 146856 5.2 Summary statistics by group Create separate state field usa_counties_states_total_rural&lt;-usa_counties_total_rural %&gt;% separate(NAME, into=c(&quot;County&quot;, &quot;State&quot;), sep=&quot;, &quot;) GEOID County State total_population rural_population 05131 Sebastian County Arkansas 125744 26170 05133 Sevier County Arkansas 17058 10849 05135 Sharp County Arkansas 17264 13821 05137 Stone County Arkansas 12394 12394 05139 Union County Arkansas 41639 22695 05141 Van Buren County Arkansas 17295 17295 Summary statistics by group group_summary&lt;-usa_counties_states_total_rural %&gt;% group_by(State) %&gt;% summarise(number_counties=n(), mean_county_pop=mean(total_population), median_county_pop=median(total_population), mean_county_rural_pop=mean(rural_population), median_rural_county_population=median(rural_population)) State number_counties mean_county_pop median_county_pop mean_county_rural_pop median_rural_county_population Alabama 67 71339.34 34339.0 29222.866 22921.0 Alaska 29 24490.72 7029.0 8322.000 4847.0 Arizona 15 426134.47 131346.0 43423.867 45970.0 Arkansas 75 38878.91 19019.0 17044.387 13821.0 California 58 642309.59 179140.5 32419.828 25167.5 Colorado 64 78581.19 15083.5 10881.797 6642.0 Connecticut 8 446762.12 231991.0 53644.375 53347.0 Delaware 3 299311.33 197145.0 49995.000 43774.0 District of Columbia 1 601723.00 601723.0 0.000 0.0 Florida 67 280616.57 98786.0 24798.000 20262.0 Georgia 159 60928.64 22598.0 15191.836 13657.0 Hawaii 5 272060.20 154834.0 21962.400 8628.0 Idaho 44 35626.86 13014.0 10482.091 8411.0 Illinois 102 125790.51 27315.5 14481.167 12556.0 Indiana 92 70476.11 33844.0 19420.674 18210.5 Iowa 99 30771.26 15679.0 11071.707 10203.0 Kansas 105 27172.55 7053.0 7011.019 4861.0 Kentucky 120 36161.39 18751.0 15050.200 13413.5 Louisiana 64 70833.94 33685.5 18993.234 16952.0 Maine 16 83022.56 53323.0 50926.188 44369.0 Maryland 24 240564.67 103129.5 30800.875 25761.5 Massachusetts 14 467687.79 479204.5 37545.714 39287.0 Michigan 83 119080.00 38520.0 30285.337 23884.0 Minnesota 87 60964.66 21676.0 16294.414 13387.0 Mississippi 82 36186.55 22989.5 18330.159 16897.0 Missouri 115 52077.63 18956.0 15396.139 11368.0 Montana 56 17668.12 7198.0 7792.875 4238.0 Nebraska 93 19638.08 6274.0 5275.860 4260.0 Nevada 17 158855.94 16528.0 9220.824 6260.0 New Hampshire 10 131647.00 83117.5 52259.800 46635.5 New Jersey 21 418661.62 448734.0 22274.667 18736.0 New Mexico 33 62399.36 27213.0 14085.394 11226.0 New York 62 312550.03 91301.0 37903.177 36800.0 North Carolina 100 95354.83 55621.5 32337.270 28833.5 North Dakota 53 12690.40 4153.0 5089.038 4007.0 Ohio 88 131096.64 58185.5 28941.023 26931.0 Oklahoma 77 48718.84 22119.0 16445.740 11572.0 Oregon 36 106418.72 41536.5 20185.889 15093.0 Pennsylvania 67 189587.75 88880.0 40464.060 36733.0 Puerto Rico 78 47766.53 35343.0 2981.192 2431.5 Rhode Island 5 210513.40 126979.0 19504.800 13270.0 South Carolina 46 100551.39 57750.0 33859.891 29681.5 South Dakota 66 12336.06 5369.5 5347.470 4172.0 Tennessee 95 66801.11 31807.0 22451.158 21747.0 Texas 254 98998.27 18381.0 15147.724 9757.5 Utah 29 95306.38 20802.0 8975.517 9245.0 Vermont 14 44695.79 36973.0 27311.143 28508.0 Virginia 134 59709.13 24544.0 14656.194 13133.5 Washington 39 172424.10 60699.0 27504.385 19725.0 West Virginia 55 33690.80 24069.0 17276.073 17541.0 Wisconsin 72 78985.92 41384.0 23574.278 22224.0 Wyoming 23 24505.48 15885.0 8636.217 7658.0 "],["elementary-visualization.html", "6 Elementary Visualization 6.1 Census data visualization with ggplot 6.2 Spatial visualization with tmap", " 6 Elementary Visualization 6.1 Census data visualization with ggplot Make a graph that visually conveys the median age in Colorado, by county, based on the 2010 census. median_age_CO&lt;- get_decennial(geography = &quot;county&quot;, state=&quot;CO&quot;, variables = &quot;P013001&quot;, geometry=TRUE, year = 2010) %&gt;% rename(median_age=value) %&gt;% mutate(County=str_remove(NAME, &quot; County, Colorado&quot;)) %&gt;% select(-NAME) View(median_age_CO) GEOID variable median_age geometry County 08053 P013001 47.1 MULTIPOLYGON (((-107.2116 3… Hinsdale 08061 P013001 47.4 MULTIPOLYGON (((-102.1985 3… Kiowa 08063 P013001 39.7 MULTIPOLYGON (((-102.0498 3… Kit Carson 08071 P013001 43.9 MULTIPOLYGON (((-104.4804 3… Las Animas 08073 P013001 40.9 MULTIPOLYGON (((-103.7149 3… Lincoln 08075 P013001 38.4 MULTIPOLYGON (((-102.9049 4… Logan median_age_CO_cleaned_visualization&lt;- median_age_CO %&gt;% ggplot(aes(x = median_age, y = reorder(County, median_age))) + geom_point()+ labs(title=&quot;Median Age by County, CO&quot;, x=&quot;Median Age&quot;, y=&quot;County&quot;, caption=&quot;Source: United States census accessed via tidycensus&quot;)+ theme(plot.title=element_text(hjust=0.5), plot.caption=element_text(size=5)) median_age_CO_cleaned_visualization 6.2 Spatial visualization with tmap median_age_CO_map&lt;- tm_shape(median_age_CO)+ tm_polygons(col=&quot;median_age&quot;, breaks=c(30,35,40,45,50), palette=&quot;YlGnBu&quot;, midpoint=TRUE)+ tm_layout(frame=FALSE, main.title=&quot;Median Age by County,\\nColorado&quot;, main.title.position=&quot;left&quot;, legend.outside=TRUE, attr.outside=TRUE)+ tm_credits(&quot;Source: US Census via tidycensus&quot;, position=c(&quot;right&quot;, &quot;bottom&quot;)) median_age_CO_map "],["functions-and-iteration.html", "7 Functions and Iteration 7.1 Automate creation of county-level median age graphs 7.2 Automate creation of median-age maps", " 7 Functions and Iteration 7.1 Automate creation of county-level median age graphs 7.1.1 Write county-level median age graph function Write a function to create a median age graph for a given state, based on two inputs: the 2 letter state abbreviation (used in the tidycensus call) and state name (used to label the graph) # Write median age graph function median_age_graph&lt;-function(state_abbrev, state_full_name){ census_call&lt;-get_decennial(geography = &quot;county&quot;, state=state_abbrev, variables = &quot;P013001&quot;, geometry=TRUE, year = 2010) %&gt;% rename(median_age=value) %&gt;% mutate(County=str_remove(NAME, paste0(&quot; County,&quot;, &quot; &quot;, state_full_name))) %&gt;% select(-NAME) median_age_ggplot&lt;- census_call %&gt;% ggplot(aes(x = median_age, y = reorder(County, median_age))) + geom_point()+ labs(title=paste0(&quot;Median Age by County,&quot;, &quot; &quot;, state_full_name), x=&quot;Median Age&quot;, y=&quot;County&quot;, caption=&quot;Source: United States census accessed via tidycensus&quot;)+ theme(plot.title=element_text(hjust=0.5), plot.caption=element_text(size=5)) return(median_age_ggplot) } # Test function for New Mexico median_age_graph(&quot;NM&quot;, &quot;New Mexico&quot;) 7.1.2 Iteratively apply median_age_graph function to multiple input elements Apply the median_age_graph function iteratively to New Mexico, Utah, Arizona, and Wyoming, thereby creating median age graphs for all these states; create a list to contain each of these output graphs as a separate list element # Create input vectors state_codes&lt;-c(&quot;NM&quot;, &quot;UT&quot;, &quot;AZ&quot;, &quot;WY&quot;) state_names&lt;-c(&quot;New Mexico&quot;, &quot;Utah&quot;, &quot;Arizona&quot;, &quot;Wyoming&quot;) # Applies the &quot;median_age_graph&quot; function to multiple inputs (specified by the input vectors), and then places the outputs (i.e. median age graphs for New Mexico, Utah, Arizona, and Wyoming) in a list assigned to an object named &quot;county_age_graphs_list&quot; county_age_graphs_list&lt;-map2(.x=state_codes, .y=state_names, .f=median_age_graph) ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;35&#39; for state &#39;NM&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;04&#39; for state &#39;AZ&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;56&#39; for state &#39;WY&#39; ## Using Census Summary File 1 # Open the list that contains the median age graphs county_age_graphs_list ## [[1]] ## ## [[2]] ## ## [[3]] ## ## [[4]] # Extract the Arizona graph by its index county_age_graphs_list %&gt;% pluck(3) # Attach names to list elements and extract by name; for convenience, we&#39;ll name list elements based on &quot;state_codes&quot; vector names(county_age_graphs_list)&lt;-state_codes # Extract the Wyoming graph by its name county_age_graphs_list %&gt;% pluck(&quot;WY&quot;) 7.2 Automate creation of median-age maps 7.2.1 Write function to create county-level median age maps Write a function to create a county-level median age map for a given state, based on two inputs: the 2 letter state abbreviation (used in the tidycensus call) and state name (used to label the map) # Write function to create county-level median age map for a given state median_age_map&lt;-function(state_abbrev, state_full_name){ census_call&lt;-get_decennial(geography = &quot;county&quot;, state=state_abbrev, variables = &quot;P013001&quot;, geometry=TRUE, year = 2010) %&gt;% rename(median_age=value) %&gt;% mutate(County=str_remove(NAME, paste0(&quot; County,&quot;, &quot; &quot;, state_full_name))) %&gt;% select(-NAME) county_median_age_map&lt;- tm_shape(census_call)+ tm_polygons(col=&quot;median_age&quot;, style=&quot;jenks&quot;, palette=&quot;YlGnBu&quot;, midpoint=TRUE)+ tm_layout(frame=FALSE, main.title=paste0(&quot;Median Age by County,\\n&quot;, state_full_name), main.title.position=&quot;left&quot;, legend.outside=TRUE, attr.outside=TRUE)+ tm_credits(&quot;Source: US Census via tidycensus&quot;, position=c(&quot;right&quot;, &quot;bottom&quot;)) return(county_median_age_map) } # Test function for New Mexico median_age_map(&quot;NM&quot;, &quot;New Mexico&quot;) 7.2.2 Iteratively apply median_age_map function to multiple input elements # Create input vectors state_codes&lt;-c(&quot;NM&quot;, &quot;UT&quot;, &quot;AZ&quot;, &quot;WY&quot;) state_names&lt;-c(&quot;New Mexico&quot;, &quot;Utah&quot;, &quot;Arizona&quot;, &quot;Wyoming&quot;) # Applies the &quot;median_age_map&quot; function to multiple inputs (specified by the input vectors), and then places the outputs (i.e. median age maps for New Mexico, Utah, Arizona, and Wyoming) in a list assigned to an object named &quot;county_age_maps_list&quot; county_age_maps_list&lt;-map2(.x=state_codes, .y=state_names,median_age_map) ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;35&#39; for state &#39;NM&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;04&#39; for state &#39;AZ&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Downloading feature geometry from the Census website. To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`. ## Using FIPS code &#39;56&#39; for state &#39;WY&#39; ## Using Census Summary File 1 # Open the list that contains the median age maps county_age_maps_list ## [[1]] ## ## [[2]] ## ## [[3]] ## ## [[4]] # Extract the Utah map by its index county_age_maps_list %&gt;% pluck(2) # Attach names (based on &quot;state_codes&quot; vector) to &quot;county_age_maps_list&quot; list elements names(county_age_maps_list)&lt;-state_codes # Extract the Arizona map by name county_age_maps_list %&gt;% pluck(&quot;AZ&quot;) "],["advanced-data-retrieval.html", "8 Advanced data retrieval 8.1 Retrieving data from multiple census years 8.2 Retrieving microgeography data from multiple states 8.3 Retrieving microgeography data from multiple states AND multiple years", " 8 Advanced data retrieval # Use tidycensus to extract tract-level data from Colorado and Utah on population (P001001) and rural population (P002005) based on 2000 decennial census; assigns data to object named &quot;population_rural_CO_UT&quot; population_rural_CO_UT&lt;-get_decennial(geography = &quot;tract&quot;, state=c(&quot;CO&quot;, &quot;UT&quot;), variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year = 2000) ## Getting data from the 2000 decennial Census 8.1 Retrieving data from multiple census years # Attempts to extract state level data (for all US states) on population (P001001) and rural population (P002005) based on 2000 decennial census and 2010 decennial census, and assign to new object named &quot;population_rural_2000_2010&quot; population_rural_2000_2010&lt;-get_decennial(geography = &quot;state&quot;, variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year = c(2000,2010)) ## Getting data from the 2000 decennial CensusGetting data from the 2010 decennial Census ## Warning in if (year == 2020) {: the condition has length &gt; 1 and only the first element will be used ## Warning in if (year == 1990) {: the condition has length &gt; 1 and only the first element will be used ## Warning in if (year == 1990) {: the condition has length &gt; 1 and only the first element will be used ## Warning in if (year == 1990) {: the condition has length &gt; 1 and only the first element will be used ## Error in parse_url(url) : length(url) == 1 is not TRUE ## Variables not found in Summary File 1. Trying Summary File 3... ## Error in UseMethod(&quot;select&quot;): no applicable method for &#39;select&#39; applied to an object of class &quot;character&quot; 8.1.1 Retrieving different census year datasets and placing them as separate elements in a list # Creates function that takes a given year as an input, and uses tidycensus to extract a state-level dataset of population (P001001) and rural population (P002005) for the specified year; the output dataset also includes new columns containing the state&#39;s rural population as a percentage of the overall population (&quot;rural_pct&quot;) and the year to which the data corresponds (&quot;year&quot;); the function is assigned to a new object named &quot;census_query&quot; census_query&lt;-function(desired_year){ get_decennial(geography = &quot;state&quot;, variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year=desired_year) %&gt;% mutate(rural_pct=(P002005/P001001)*100) %&gt;% mutate(year=desired_year) } # Test the &quot;census_query&quot; object for the year 2000 census_query(2000) ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4447100 1981427 44.6 2000 ## 2 02 Alaska 626932 215675 34.4 2000 ## 3 04 Arizona 5130632 607097 11.8 2000 ## 4 05 Arkansas 2673400 1269221 47.5 2000 ## 5 06 California 33871648 1881985 5.56 2000 ## 6 08 Colorado 4301261 668076 15.5 2000 ## 7 09 Connecticut 3405565 417506 12.3 2000 ## 8 10 Delaware 783600 155842 19.9 2000 ## 9 11 District of Columbia 572059 0 0 2000 ## 10 12 Florida 15982378 1712358 10.7 2000 ## # … with 42 more rows # Creates a new vector, assigned to an object named &quot;my_years&quot;, containing the years for which we want to extract data my_years&lt;-c(2000,2010) # Applies the &quot;census_query&quot; function to the inputs specified by the &quot;my_years&quot; vector, and deposits the two resulting datasets (one from 2000 and the other from 2010) as distinct elements in a list assigned to an object named population_rural_2000_2010_list population_rural_2000_2010_list&lt;-map(.x=my_years, .f=census_query) ## Getting data from the 2000 decennial Census ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using Census Summary File 1 # Prints the contents of &quot;population_rural_2000_2010_list&quot; population_rural_2000_2010_list ## [[1]] ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4447100 1981427 44.6 2000 ## 2 02 Alaska 626932 215675 34.4 2000 ## 3 04 Arizona 5130632 607097 11.8 2000 ## 4 05 Arkansas 2673400 1269221 47.5 2000 ## 5 06 California 33871648 1881985 5.56 2000 ## 6 08 Colorado 4301261 668076 15.5 2000 ## 7 09 Connecticut 3405565 417506 12.3 2000 ## 8 10 Delaware 783600 155842 19.9 2000 ## 9 11 District of Columbia 572059 0 0 2000 ## 10 12 Florida 15982378 1712358 10.7 2000 ## # … with 42 more rows ## ## [[2]] ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4779736 1957932 41.0 2010 ## 2 02 Alaska 710231 241338 34.0 2010 ## 3 04 Arizona 6392017 651358 10.2 2010 ## 4 05 Arkansas 2915918 1278329 43.8 2010 ## 5 06 California 37253956 1880350 5.05 2010 ## 6 22 Louisiana 4533372 1215567 26.8 2010 ## 7 21 Kentucky 4339367 1806024 41.6 2010 ## 8 08 Colorado 5029196 696435 13.8 2010 ## 9 09 Connecticut 3574097 429155 12.0 2010 ## 10 10 Delaware 897934 149985 16.7 2010 ## # … with 42 more rows # Extracts the first list element (the 2000 dataset) from the list using its index population_rural_2000_2010_list %&gt;% pluck(1) ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4447100 1981427 44.6 2000 ## 2 02 Alaska 626932 215675 34.4 2000 ## 3 04 Arizona 5130632 607097 11.8 2000 ## 4 05 Arkansas 2673400 1269221 47.5 2000 ## 5 06 California 33871648 1881985 5.56 2000 ## 6 08 Colorado 4301261 668076 15.5 2000 ## 7 09 Connecticut 3405565 417506 12.3 2000 ## 8 10 Delaware 783600 155842 19.9 2000 ## 9 11 District of Columbia 572059 0 0 2000 ## 10 12 Florida 15982378 1712358 10.7 2000 ## # … with 42 more rows # Names the list elements based on the input years (i.e. the years in &quot;my_years&quot;) names(population_rural_2000_2010_list)&lt;-my_years # prints &quot;population_rural_2000_2010_list&quot;; notice the list elements are now named after the years to which they correspond population_rural_2000_2010_list ## $`2000` ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4447100 1981427 44.6 2000 ## 2 02 Alaska 626932 215675 34.4 2000 ## 3 04 Arizona 5130632 607097 11.8 2000 ## 4 05 Arkansas 2673400 1269221 47.5 2000 ## 5 06 California 33871648 1881985 5.56 2000 ## 6 08 Colorado 4301261 668076 15.5 2000 ## 7 09 Connecticut 3405565 417506 12.3 2000 ## 8 10 Delaware 783600 155842 19.9 2000 ## 9 11 District of Columbia 572059 0 0 2000 ## 10 12 Florida 15982378 1712358 10.7 2000 ## # … with 42 more rows ## ## $`2010` ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4779736 1957932 41.0 2010 ## 2 02 Alaska 710231 241338 34.0 2010 ## 3 04 Arizona 6392017 651358 10.2 2010 ## 4 05 Arkansas 2915918 1278329 43.8 2010 ## 5 06 California 37253956 1880350 5.05 2010 ## 6 22 Louisiana 4533372 1215567 26.8 2010 ## 7 21 Kentucky 4339367 1806024 41.6 2010 ## 8 08 Colorado 5029196 696435 13.8 2010 ## 9 09 Connecticut 3574097 429155 12.0 2010 ## 10 10 Delaware 897934 149985 16.7 2010 ## # … with 42 more rows # Extracts the 2010 dataset from &quot;population_rural_2000_2010_list&quot; using its newly assigned name population_rural_2000_2010_list %&gt;% pluck(&quot;2010&quot;) ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4779736 1957932 41.0 2010 ## 2 02 Alaska 710231 241338 34.0 2010 ## 3 04 Arizona 6392017 651358 10.2 2010 ## 4 05 Arkansas 2915918 1278329 43.8 2010 ## 5 06 California 37253956 1880350 5.05 2010 ## 6 22 Louisiana 4533372 1215567 26.8 2010 ## 7 21 Kentucky 4339367 1806024 41.6 2010 ## 8 08 Colorado 5029196 696435 13.8 2010 ## 9 09 Connecticut 3574097 429155 12.0 2010 ## 10 10 Delaware 897934 149985 16.7 2010 ## # … with 42 more rows # Note that even if a list element is named, you can still extract it using its index, rather than its name population_rural_2000_2010_list %&gt;% pluck(2) ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4779736 1957932 41.0 2010 ## 2 02 Alaska 710231 241338 34.0 2010 ## 3 04 Arizona 6392017 651358 10.2 2010 ## 4 05 Arkansas 2915918 1278329 43.8 2010 ## 5 06 California 37253956 1880350 5.05 2010 ## 6 22 Louisiana 4533372 1215567 26.8 2010 ## 7 21 Kentucky 4339367 1806024 41.6 2010 ## 8 08 Colorado 5029196 696435 13.8 2010 ## 9 09 Connecticut 3574097 429155 12.0 2010 ## 10 10 Delaware 897934 149985 16.7 2010 ## # … with 42 more rows 8.1.2 Retrieving different census year datasets and placing them in a single data frame # Applies the &quot;census_query&quot; function to the inputs specified by the &quot;my_years&quot; vector, and deposits the resulting census datasets (one from 2000 and the other from 2010) into a single data frame assigned to an object named &quot;population_rural_2000_2010_df&quot; population_rural_2000_2010_df&lt;-map_dfr(.x=my_years, .f=census_query) %&gt;% arrange(GEOID) # prints the first few records of &quot;population_rural_2000_2010_df&quot; population_rural_2000_2010_df ## # A tibble: 104 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4447100 1981427 44.6 2000 ## 2 01 Alabama 4779736 1957932 41.0 2010 ## 3 02 Alaska 626932 215675 34.4 2000 ## 4 02 Alaska 710231 241338 34.0 2010 ## 5 04 Arizona 5130632 607097 11.8 2000 ## 6 04 Arizona 6392017 651358 10.2 2010 ## 7 05 Arkansas 2673400 1269221 47.5 2000 ## 8 05 Arkansas 2915918 1278329 43.8 2010 ## 9 06 California 33871648 1881985 5.56 2000 ## 10 06 California 37253956 1880350 5.05 2010 ## # … with 94 more rows 8.2 Retrieving microgeography data from multiple states # Attempts to retrieve tract-level data on overall population (P001001) and rural population (P002005) from Colorado and Utah, based on the 2000 decennial census; then, creates a new variable named &quot;rural_pct&quot; that captures each tracts rural share of the overall population, as well as a new variable named &quot;rural_pct&quot; population_rural_CO_UT&lt;-get_decennial(geography = &quot;tract&quot;, state=c(&quot;CO&quot;,&quot;UT&quot;), variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year=2000) %&gt;% mutate(rural_pct=(P002005/P001001)*100) ## Getting data from the 2000 decennial Census 8.2.1 Retrieving microgeography datasets for multiple states and placing datasets into a list # Creates a function assigned to an object named &quot;population_rural_statetract&quot; that takes a given state input (&quot;desired_state), and passes this state into tidycensus&#39;s &quot;get_decennial&quot; function to retrieve a tract-level dataset for that state containing data on overall population (P001001) and rural population (P002005) based on the 2010 decennial census, while also creating three new variables: &quot;rural_pct&quot; (the percentage of the overall population that is rural), &quot;Year&quot; (a varaiable that takes on the value 2010, so that we can readily identify that the data corresponds to the year 2010), and &quot;STATE&quot; (an ID variable that will take on the value of the state input, so that we can readily identify the state for which the data has been extracted) population_rural_statetract&lt;-function(desired_state){ get_decennial(geography = &quot;tract&quot;, state=desired_state, variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year=2010) %&gt;% mutate(rural_pct=(P002005/P001001)*100) %&gt;% mutate(Year=2010) %&gt;% mutate(STATE=desired_state) } # Test the function for a given state; here, California (&quot;CA) population_rural_statetract(&quot;CA&quot;) ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;06&#39; for state &#39;CA&#39; ## Using Census Summary File 1 ## # A tibble: 8,057 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 06037434004 Census Tract 4340.04, Los Angeles County, California 2796 0 0 2010 CA ## 2 06037460000 Census Tract 4600, Los Angeles County, California 4851 0 0 2010 CA ## 3 06037460200 Census Tract 4602, Los Angeles County, California 5315 0 0 2010 CA ## 4 06037460301 Census Tract 4603.01, Los Angeles County, California 4638 0 0 2010 CA ## 5 06037460302 Census Tract 4603.02, Los Angeles County, California 4442 0 0 2010 CA ## 6 06037460401 Census Tract 4604.01, Los Angeles County, California 878 0 0 2010 CA ## 7 06037621301 Census Tract 6213.01, Los Angeles County, California 6769 0 0 2010 CA ## 8 06037621324 Census Tract 6213.24, Los Angeles County, California 3842 0 0 2010 CA ## 9 06037621326 Census Tract 6213.26, Los Angeles County, California 3260 0 0 2010 CA ## 10 06037621400 Census Tract 6214, Los Angeles County, California 4414 0 0 2010 CA ## # … with 8,047 more rows Now that we know the function works, let’s apply it to extract our desired dataset for Colorado and Utah, and place these datasets into a list: # define a vector of desired states and assign it to an object named &quot;my_states&quot; my_states&lt;-c(&quot;CO&quot;, &quot;UT&quot;) # Applies the &quot;population_rural_state_tract&quot; function to the inputs specified by the &quot;my_states&quot; vector, and deposits the two resulting datasets (one for CO, and the other for UT) as distinct elements in a list assigned to an object named population_rural_CO_UT_list population_rural_CO_UT_list&lt;-map(.x=my_states, .f=population_rural_statetract) ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 # Prints the contents of &quot;population_rural_CO_UT_list&quot; population_rural_CO_UT_list ## [[1]] ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows ## ## [[2]] ## # A tibble: 588 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49011125805 Census Tract 1258.05, Davis County, Utah 6167 0 0 2010 UT ## 2 49011125301 Census Tract 1253.01, Davis County, Utah 5108 0 0 2010 UT ## 3 49011125305 Census Tract 1253.05, Davis County, Utah 6152 0 0 2010 UT ## 4 49011125702 Census Tract 1257.02, Davis County, Utah 3839 0 0 2010 UT ## 5 49011125801 Census Tract 1258.01, Davis County, Utah 6703 0 0 2010 UT ## 6 49011125804 Census Tract 1258.04, Davis County, Utah 6377 0 0 2010 UT ## 7 49011125807 Census Tract 1258.07, Davis County, Utah 3114 0 0 2010 UT ## 8 49011125808 Census Tract 1258.08, Davis County, Utah 5616 0 0 2010 UT ## 9 49011125905 Census Tract 1259.05, Davis County, Utah 6156 0 0 2010 UT ## 10 49011125906 Census Tract 1259.06, Davis County, Utah 6987 0 0 2010 UT ## # … with 578 more rows # Use the &quot;pluck&quot; function to extract the Colorado dataset from &quot;population_rural_CO_UT_list&quot; by its index population_rural_CO_UT_list %&gt;% pluck(1) ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows # Name the list elements in &quot;population_rural_CO_UT_list&quot; based on the &quot;my_states&quot; vector names(population_rural_CO_UT_list)&lt;-my_states # Print &quot;population_rural_CO_UT_list&quot; list contents; notice that they&#39;re now named based on the state population_rural_CO_UT_list ## $CO ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows ## ## $UT ## # A tibble: 588 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49011125805 Census Tract 1258.05, Davis County, Utah 6167 0 0 2010 UT ## 2 49011125301 Census Tract 1253.01, Davis County, Utah 5108 0 0 2010 UT ## 3 49011125305 Census Tract 1253.05, Davis County, Utah 6152 0 0 2010 UT ## 4 49011125702 Census Tract 1257.02, Davis County, Utah 3839 0 0 2010 UT ## 5 49011125801 Census Tract 1258.01, Davis County, Utah 6703 0 0 2010 UT ## 6 49011125804 Census Tract 1258.04, Davis County, Utah 6377 0 0 2010 UT ## 7 49011125807 Census Tract 1258.07, Davis County, Utah 3114 0 0 2010 UT ## 8 49011125808 Census Tract 1258.08, Davis County, Utah 5616 0 0 2010 UT ## 9 49011125905 Census Tract 1259.05, Davis County, Utah 6156 0 0 2010 UT ## 10 49011125906 Census Tract 1259.06, Davis County, Utah 6987 0 0 2010 UT ## # … with 578 more rows # Use the &quot;pluck&quot; function to extract the Utah dataset from &quot;population_rural_CO_UT_list&quot; by name population_rural_CO_UT_list %&gt;% pluck(&quot;UT&quot;) ## # A tibble: 588 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49011125805 Census Tract 1258.05, Davis County, Utah 6167 0 0 2010 UT ## 2 49011125301 Census Tract 1253.01, Davis County, Utah 5108 0 0 2010 UT ## 3 49011125305 Census Tract 1253.05, Davis County, Utah 6152 0 0 2010 UT ## 4 49011125702 Census Tract 1257.02, Davis County, Utah 3839 0 0 2010 UT ## 5 49011125801 Census Tract 1258.01, Davis County, Utah 6703 0 0 2010 UT ## 6 49011125804 Census Tract 1258.04, Davis County, Utah 6377 0 0 2010 UT ## 7 49011125807 Census Tract 1258.07, Davis County, Utah 3114 0 0 2010 UT ## 8 49011125808 Census Tract 1258.08, Davis County, Utah 5616 0 0 2010 UT ## 9 49011125905 Census Tract 1259.05, Davis County, Utah 6156 0 0 2010 UT ## 10 49011125906 Census Tract 1259.06, Davis County, Utah 6987 0 0 2010 UT ## # … with 578 more rows 8.2.2 Retrieving microgeography data from multiple states and placing them into the same data frame # Applies the &quot;population_rural_statetract&quot; function to the inputs specified by the &quot;my_states&quot; vector, and deposits the resulting census datasets (one CO and the other UT) into a single data frame assigned to an object named &quot;population_rural_CO_UT_df&quot; population_rural_CO_UT_df&lt;-map_dfr(.x=my_states, .f=population_rural_statetract) ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 # Prints the contents of &quot;population_rural_CO_UT_df&quot; population_rural_CO_UT_df ## # A tibble: 1,837 x 7 ## GEOID NAME P001001 P002005 rural_pct Year STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,827 more rows 8.3 Retrieving microgeography data from multiple states AND multiple years We can use the same principles to extract census datasets at sub-state geographies for multiple states, across from multiple years. 8.3.1 Retrieving data from multiple years, for multiple states, and placing the datasets from the various state/year combinations into a list # Define a function (assigned to an object named &quot;population_rural_statetract_year&quot;) that takes a state input (&quot;desired_state&quot;) and a year input (&quot;desired_year), and returns a tract level dataset for that state and census year which contains variables specifying the total population, and the rural population, while also creating three new variables: &quot;rural_pct&quot; (the percentage of the overall tract population that is rural), &quot;YEAR&quot; (a varaiable that takes on the value of the input, so that we can readily identify what year the data corresponds to), and &quot;STATE&quot; (an ID variable that will take on the value of the state input, so that we can readily identify the state for which the data has been extracted) population_rural_statetract_year&lt;-function(desired_state, desired_year){ get_decennial(geography = &quot;tract&quot;, state=desired_state, variables = c(&quot;P001001&quot;, &quot;P002005&quot;), output=&quot;wide&quot;, year=desired_year) %&gt;% mutate(rural_pct=(P002005/P001001)*100) %&gt;% mutate(YEAR=desired_year) %&gt;% mutate(STATE=desired_state) } # Tests the &quot;population_rural_CO_UT_2000_2010&quot; function for Virginia, for the 2010 census population_rural_statetract_year(&quot;VA&quot;, 2010) ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;51&#39; for state &#39;VA&#39; ## Using Census Summary File 1 ## # A tibble: 1,907 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 51059421200 Census Tract 4212, Fairfax County, Virginia 1926 0 0 2010 VA ## 2 51059421400 Census Tract 4214, Fairfax County, Virginia 7158 0 0 2010 VA ## 3 51059421600 Census Tract 4216, Fairfax County, Virginia 6342 0 0 2010 VA ## 4 51059421702 Census Tract 4217.02, Fairfax County, Virginia 4054 0 0 2010 VA ## 5 51059421800 Census Tract 4218, Fairfax County, Virginia 5862 0 0 2010 VA ## 6 51059421900 Census Tract 4219, Fairfax County, Virginia 2216 0 0 2010 VA ## 7 51059422000 Census Tract 4220, Fairfax County, Virginia 3439 0 0 2010 VA ## 8 51059422102 Census Tract 4221.02, Fairfax County, Virginia 6101 0 0 2010 VA ## 9 51059422201 Census Tract 4222.01, Fairfax County, Virginia 3394 0 0 2010 VA ## 10 51059422202 Census Tract 4222.02, Fairfax County, Virginia 5518 0 0 2010 VA ## # … with 1,897 more rows Now, we can iteratively apply the population_rural_statetract_year function to multiple state/year inputs. In the example below, we use population_rural_statetract_year to extract data from the 2000 and 2010 censuses, for both Colorado and Utah, and deposit the resulting four datasets (CO/2000, CO/2010, UT/2000, UT/2010) into a list # define a vector of desired states to iterate over, and assign it to an obejct named &quot;my_states&quot; my_states&lt;-c(&quot;CO&quot;, &quot;CO&quot;, &quot;UT&quot;, &quot;UT&quot;) # define a vector of desired years to iterate over, and assign it to an object named &quot;my_years&quot; my_years&lt;-c(2000, 2010, 2000, 2010) # Applies the &quot;population_rural_statetract_year&quot; function to the inputs specified by the &quot;my_states&quot; and &quot;my_year&quot; vectors, and deposits the resulting four census datasets (one for CO 2000; one for CO 2010; one for UT 2000; one for UT 2010) as distinct elements in a list that is assigned to an object named &quot;population_rural_CO_UT_2000_2010_list&quot; population_rural_CO_UT_2000_2010_list&lt;-map2(.x=my_states, .y=my_years, .f=population_rural_statetract_year) ## Getting data from the 2000 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 ## Getting data from the 2000 decennial Census ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 # Prints contents of &quot;population_rural_CO_UT_2000_2010_list&quot; population_rural_CO_UT_2000_2010_list ## [[1]] ## # A tibble: 1,062 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08001007800 Census Tract 78, Adams County, Colorado 8378 0 0 2000 CO ## 2 08001007900 Census Tract 79, Adams County, Colorado 6617 0 0 2000 CO ## 3 08001008000 Census Tract 80, Adams County, Colorado 6183 0 0 2000 CO ## 4 08001008100 Census Tract 81, Adams County, Colorado 1050 0 0 2000 CO ## 5 08001008200 Census Tract 82, Adams County, Colorado 5393 0 0 2000 CO ## 6 08001008308 Census Tract 83.08, Adams County, Colorado 4972 0 0 2000 CO ## 7 08001008309 Census Tract 83.09, Adams County, Colorado 3052 50 1.64 2000 CO ## 8 08001008353 Census Tract 83.53, Adams County, Colorado 4612 174 3.77 2000 CO ## 9 08001008385 Census Tract 83.85, Adams County, Colorado 0 0 NaN 2000 CO ## 10 08001008401 Census Tract 84.01, Adams County, Colorado 3261 3261 100 2000 CO ## # … with 1,052 more rows ## ## [[2]] ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows ## ## [[3]] ## # A tibble: 496 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49001100100 Census Tract 1001, Beaver County, Utah 3314 3314 100 2000 UT ## 2 49001100200 Census Tract 1002, Beaver County, Utah 2691 2691 100 2000 UT ## 3 49003960100 Census Tract 9601, Box Elder County, Utah 2712 2712 100 2000 UT ## 4 49003960200 Census Tract 9602, Box Elder County, Utah 6037 4134 68.5 2000 UT ## 5 49003960300 Census Tract 9603, Box Elder County, Utah 6223 889 14.3 2000 UT ## 6 49003960400 Census Tract 9604, Box Elder County, Utah 4521 4521 100 2000 UT ## 7 49003960500 Census Tract 9605, Box Elder County, Utah 4567 435 9.52 2000 UT ## 8 49003960600 Census Tract 9606, Box Elder County, Utah 6543 182 2.78 2000 UT ## 9 49003960701 Census Tract 9607.01, Box Elder County, Utah 4396 0 0 2000 UT ## 10 49003960702 Census Tract 9607.02, Box Elder County, Utah 2225 0 0 2000 UT ## # … with 486 more rows ## ## [[4]] ## # A tibble: 588 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49011125805 Census Tract 1258.05, Davis County, Utah 6167 0 0 2010 UT ## 2 49011125301 Census Tract 1253.01, Davis County, Utah 5108 0 0 2010 UT ## 3 49011125305 Census Tract 1253.05, Davis County, Utah 6152 0 0 2010 UT ## 4 49011125702 Census Tract 1257.02, Davis County, Utah 3839 0 0 2010 UT ## 5 49011125801 Census Tract 1258.01, Davis County, Utah 6703 0 0 2010 UT ## 6 49011125804 Census Tract 1258.04, Davis County, Utah 6377 0 0 2010 UT ## 7 49011125807 Census Tract 1258.07, Davis County, Utah 3114 0 0 2010 UT ## 8 49011125808 Census Tract 1258.08, Davis County, Utah 5616 0 0 2010 UT ## 9 49011125905 Census Tract 1259.05, Davis County, Utah 6156 0 0 2010 UT ## 10 49011125906 Census Tract 1259.06, Davis County, Utah 6987 0 0 2010 UT ## # … with 578 more rows # Uses the ```pluck``` function to extract the Colorado/2010 dataset from &quot;population_rural_CO_UT_2000_2010_list&quot; population_rural_CO_UT_2000_2010_list %&gt;% pluck(2) ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows # Creates a name vector in which the four different state/year combinations are connected by an underscore (&quot;_&quot;) and assigns the resulting vector to an object named &quot;name_vector&quot; name_vector&lt;-paste0(my_states, &quot;_&quot;, my_years) # Prints &quot;name_vector&quot; to inspect contents name_vector ## [1] &quot;CO_2000&quot; &quot;CO_2010&quot; &quot;UT_2000&quot; &quot;UT_2010&quot; # Assigns the names in &quot;name_vector&quot; to the list elements names(population_rural_CO_UT_2000_2010_list)&lt;-name_vector # Prints the contents of &quot;population_rural_CO_UT_2000_2010_list&quot;; note that the list elements are now named according to the state/year inputs upon which they are based population_rural_CO_UT_2000_2010_list ## $CO_2000 ## # A tibble: 1,062 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08001007800 Census Tract 78, Adams County, Colorado 8378 0 0 2000 CO ## 2 08001007900 Census Tract 79, Adams County, Colorado 6617 0 0 2000 CO ## 3 08001008000 Census Tract 80, Adams County, Colorado 6183 0 0 2000 CO ## 4 08001008100 Census Tract 81, Adams County, Colorado 1050 0 0 2000 CO ## 5 08001008200 Census Tract 82, Adams County, Colorado 5393 0 0 2000 CO ## 6 08001008308 Census Tract 83.08, Adams County, Colorado 4972 0 0 2000 CO ## 7 08001008309 Census Tract 83.09, Adams County, Colorado 3052 50 1.64 2000 CO ## 8 08001008353 Census Tract 83.53, Adams County, Colorado 4612 174 3.77 2000 CO ## 9 08001008385 Census Tract 83.85, Adams County, Colorado 0 0 NaN 2000 CO ## 10 08001008401 Census Tract 84.01, Adams County, Colorado 3261 3261 100 2000 CO ## # … with 1,052 more rows ## ## $CO_2010 ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows ## ## $UT_2000 ## # A tibble: 496 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49001100100 Census Tract 1001, Beaver County, Utah 3314 3314 100 2000 UT ## 2 49001100200 Census Tract 1002, Beaver County, Utah 2691 2691 100 2000 UT ## 3 49003960100 Census Tract 9601, Box Elder County, Utah 2712 2712 100 2000 UT ## 4 49003960200 Census Tract 9602, Box Elder County, Utah 6037 4134 68.5 2000 UT ## 5 49003960300 Census Tract 9603, Box Elder County, Utah 6223 889 14.3 2000 UT ## 6 49003960400 Census Tract 9604, Box Elder County, Utah 4521 4521 100 2000 UT ## 7 49003960500 Census Tract 9605, Box Elder County, Utah 4567 435 9.52 2000 UT ## 8 49003960600 Census Tract 9606, Box Elder County, Utah 6543 182 2.78 2000 UT ## 9 49003960701 Census Tract 9607.01, Box Elder County, Utah 4396 0 0 2000 UT ## 10 49003960702 Census Tract 9607.02, Box Elder County, Utah 2225 0 0 2000 UT ## # … with 486 more rows ## ## $UT_2010 ## # A tibble: 588 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 49011125805 Census Tract 1258.05, Davis County, Utah 6167 0 0 2010 UT ## 2 49011125301 Census Tract 1253.01, Davis County, Utah 5108 0 0 2010 UT ## 3 49011125305 Census Tract 1253.05, Davis County, Utah 6152 0 0 2010 UT ## 4 49011125702 Census Tract 1257.02, Davis County, Utah 3839 0 0 2010 UT ## 5 49011125801 Census Tract 1258.01, Davis County, Utah 6703 0 0 2010 UT ## 6 49011125804 Census Tract 1258.04, Davis County, Utah 6377 0 0 2010 UT ## 7 49011125807 Census Tract 1258.07, Davis County, Utah 3114 0 0 2010 UT ## 8 49011125808 Census Tract 1258.08, Davis County, Utah 5616 0 0 2010 UT ## 9 49011125905 Census Tract 1259.05, Davis County, Utah 6156 0 0 2010 UT ## 10 49011125906 Census Tract 1259.06, Davis County, Utah 6987 0 0 2010 UT ## # … with 578 more rows # Uses the ```pluck``` function to extract the 2010 Colorado dataset by name population_rural_CO_UT_2000_2010_list %&gt;% pluck(&quot;CO_2010&quot;) ## # A tibble: 1,249 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08013013602 Census Tract 136.02, Boulder County, Colorado 912 912 100 2010 CO ## 2 08013013701 Census Tract 137.01, Boulder County, Colorado 6334 5095 80.4 2010 CO ## 3 08013013702 Census Tract 137.02, Boulder County, Colorado 5952 5952 100 2010 CO ## 4 08013060600 Census Tract 606, Boulder County, Colorado 5325 231 4.34 2010 CO ## 5 08013060700 Census Tract 607, Boulder County, Colorado 3091 111 3.59 2010 CO ## 6 08013060800 Census Tract 608, Boulder County, Colorado 6107 192 3.14 2010 CO ## 7 08013060900 Census Tract 609, Boulder County, Colorado 4139 0 0 2010 CO ## 8 08013061300 Census Tract 613, Boulder County, Colorado 3417 0 0 2010 CO ## 9 08013061400 Census Tract 614, Boulder County, Colorado 3990 0 0 2010 CO ## 10 08014030000 Census Tract 300, Broomfield County, Colorado 3378 0 0 2010 CO ## # … with 1,239 more rows 8.3.2 Retrieving data from multiple years, for multiple states, and placing all of the data into a single data frame # # Applies the &quot;population_rural_statetract_year&quot; function to the inputs specified by the &quot;my_states&quot; and &quot;my_years&quot; vectors, and deposits the resulting four census datasets (CO/2000, CO/2010, UT/2000, UT/2010) into a single data frame assigned to an object named &quot;population_rural_CO_UT_2000_2010_df&quot; population_rural_CO_UT_2000_2010_df&lt;-map2_dfr(.x=my_states, .y=my_years, .f=population_rural_statetract_year) ## Getting data from the 2000 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;08&#39; for state &#39;CO&#39; ## Using Census Summary File 1 ## Getting data from the 2000 decennial Census ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 ## Getting data from the 2010 decennial Census ## Using FIPS code &#39;49&#39; for state &#39;UT&#39; ## Using Census Summary File 1 # Prints the contents of &quot;population_rural_CO_UT_2000_2010_df&quot; population_rural_CO_UT_2000_2010_df ## # A tibble: 3,395 x 7 ## GEOID NAME P001001 P002005 rural_pct YEAR STATE ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 08001007800 Census Tract 78, Adams County, Colorado 8378 0 0 2000 CO ## 2 08001007900 Census Tract 79, Adams County, Colorado 6617 0 0 2000 CO ## 3 08001008000 Census Tract 80, Adams County, Colorado 6183 0 0 2000 CO ## 4 08001008100 Census Tract 81, Adams County, Colorado 1050 0 0 2000 CO ## 5 08001008200 Census Tract 82, Adams County, Colorado 5393 0 0 2000 CO ## 6 08001008308 Census Tract 83.08, Adams County, Colorado 4972 0 0 2000 CO ## 7 08001008309 Census Tract 83.09, Adams County, Colorado 3052 50 1.64 2000 CO ## 8 08001008353 Census Tract 83.53, Adams County, Colorado 4612 174 3.77 2000 CO ## 9 08001008385 Census Tract 83.85, Adams County, Colorado 0 0 NaN 2000 CO ## 10 08001008401 Census Tract 84.01, Adams County, Colorado 3261 3261 100 2000 CO ## # … with 3,385 more rows https://mattherman.info/blog/tidycensus-mult-year/ median age by county colorado vis and map functions and iteration advanced retrieval temporal dynamics "],["working-with-multiple-datasets.html", "9 Working with multiple datasets", " 9 Working with multiple datasets It is often useful to bring separate datasets together in order to carry out a given analytic task. For instance, one might want to compare change over time by bringing together census datasets from different years (though it’s worth noting that temporal analysis with census data can be tricky, and must be undertaken with caution, due to changes in calculation methods or geographic borders across different census years). For example, let’s say we want to visualize the percentage point change in every state’s rural population share between 2000 and 2010. In other words, how did the percentage of each states rural population (with respect to its overall population) change across the first decade of the 2000s? Which states saw the greatest degree of rural depopulation, and which states saw the lowest degree of rural depopulation? Let’s begin with the population_rural_2000_2010_list object that we created in the previous section. It’s a list that contains information on the percentage of each state’s population living in rural areas; the first list element contains information on states’ rural population share from the 2000 census, while the second contains analogous information from the 2010 census. # Prints contents of &quot;population_rural_2000_2010_list&quot; population_rural_2000_2010_list ## $`2000` ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4447100 1981427 44.6 2000 ## 2 02 Alaska 626932 215675 34.4 2000 ## 3 04 Arizona 5130632 607097 11.8 2000 ## 4 05 Arkansas 2673400 1269221 47.5 2000 ## 5 06 California 33871648 1881985 5.56 2000 ## 6 08 Colorado 4301261 668076 15.5 2000 ## 7 09 Connecticut 3405565 417506 12.3 2000 ## 8 10 Delaware 783600 155842 19.9 2000 ## 9 11 District of Columbia 572059 0 0 2000 ## 10 12 Florida 15982378 1712358 10.7 2000 ## # … with 42 more rows ## ## $`2010` ## # A tibble: 52 x 6 ## GEOID NAME P001001 P002005 rural_pct year ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 4779736 1957932 41.0 2010 ## 2 02 Alaska 710231 241338 34.0 2010 ## 3 04 Arizona 6392017 651358 10.2 2010 ## 4 05 Arkansas 2915918 1278329 43.8 2010 ## 5 06 California 37253956 1880350 5.05 2010 ## 6 22 Louisiana 4533372 1215567 26.8 2010 ## 7 21 Kentucky 4339367 1806024 41.6 2010 ## 8 08 Colorado 5029196 696435 13.8 2010 ## 9 09 Connecticut 3574097 429155 12.0 2010 ## 10 10 Delaware 897934 149985 16.7 2010 ## # … with 42 more rows In order to visualize the percentage point difference in state-level rural population shares between 2010 and 2000, we can join the two datasets in population_rural_2000_2010_list, compute the difference between “rural_pct” in the 2010 dataset and “rural_pct” in the 2000 dataset, and then use now-familiar visualization techniques to visualize this difference. Before joining the two datasets, it might make sense to clean them up to avoid any confusion after we implement the join. First, it would be nice to rename the “rural_pct” variable in the two datasets to indicate the relevant year, i.e. in the form “rural_pct_YEAR” where YEAR takes on the value in the existing “year” column. After renaming the “rural_pct” variable in this way, we can go ahead and delete the “P001001”, “P002005”, and “year” columns, since they do not contain necessary information, and will simply clutter the final (joined) dataset. To clean up the datasets in this way, let’s write a function that makes these changes, and use now-familiar iteration techniques to apply the changes to both of the list elements in population_rural_2000_2010_list. # Write function to clean dataset according to the requirements specified above and assign to an object named &quot;cleaning_function&quot; cleaning_function&lt;-function(dataset){ year_vector&lt;-dataset$year # extracts the &quot;year&quot; column as a vector year_extracted&lt;-year_vector[1] # plucks out the first element of &quot;year_vector&quot; desired_name&lt;-paste0(&quot;rural_pct&quot;, &quot;_&quot;, year_extracted) # creates desired name string names(dataset)[5]&lt;-desired_name # renames &quot;rural_pct&quot; with &quot;desired_name&quot; final&lt;-dataset %&gt;% select(-c(P001001, P002005, year)) # deletes specified columns return(final) # returns cleaned dataset } # applies &quot;cleaning_function&quot; to both of the list elements in ```population_rural_2000_2010_list``` and assigns the result to a new object named &quot;population_rural_2000_2010_list_cleaned&quot; population_rural_2000_2010_list_cleaned&lt;-map(population_rural_2000_2010_list, cleaning_function) # Prints contents of &quot;population_rural_2000_2010_list_cleaned&quot; population_rural_2000_2010_list_cleaned ## $`2000` ## # A tibble: 52 x 3 ## GEOID NAME rural_pct_2000 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 01 Alabama 44.6 ## 2 02 Alaska 34.4 ## 3 04 Arizona 11.8 ## 4 05 Arkansas 47.5 ## 5 06 California 5.56 ## 6 08 Colorado 15.5 ## 7 09 Connecticut 12.3 ## 8 10 Delaware 19.9 ## 9 11 District of Columbia 0 ## 10 12 Florida 10.7 ## # … with 42 more rows ## ## $`2010` ## # A tibble: 52 x 3 ## GEOID NAME rural_pct_2010 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 01 Alabama 41.0 ## 2 02 Alaska 34.0 ## 3 04 Arizona 10.2 ## 4 05 Arkansas 43.8 ## 5 06 California 5.05 ## 6 22 Louisiana 26.8 ## 7 21 Kentucky 41.6 ## 8 08 Colorado 13.8 ## 9 09 Connecticut 12.0 ## 10 10 Delaware 16.7 ## # … with 42 more rows Now, let’s merge these datasets together, using “GEOID” as the join variable: # Joins datasets in list and assigns joined dataset to object named &quot;rural_change&quot; rural_change&lt;-full_join(population_rural_2000_2010_list_cleaned[[&quot;2010&quot;]], population_rural_2000_2010_list_cleaned[[&quot;2000&quot;]], by=&quot;GEOID&quot;) # cleans &quot;rural_change&quot; by deleting &quot;NAME.y&quot; and renaming &quot;NAME.x&quot;, and then creates new variable that captures the difference between &quot;rural_pct_2010&quot; and &quot;rural_pct_2000&quot; rural_change&lt;-rural_change %&gt;% select(-(NAME.y)) %&gt;% rename(NAME=NAME.x) %&gt;% mutate(rural_share_change=rural_pct_2010-rural_pct_2000) # prints modified &quot;rural_change&quot; object rural_change ## # A tibble: 52 x 5 ## GEOID NAME rural_pct_2010 rural_pct_2000 rural_share_change ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 01 Alabama 41.0 44.6 -3.59 ## 2 02 Alaska 34.0 34.4 -0.421 ## 3 04 Arizona 10.2 11.8 -1.64 ## 4 05 Arkansas 43.8 47.5 -3.64 ## 5 06 California 5.05 5.56 -0.509 ## 6 22 Louisiana 26.8 27.4 -0.560 ## 7 21 Kentucky 41.6 44.2 -2.62 ## 8 08 Colorado 13.8 15.5 -1.68 ## 9 09 Connecticut 12.0 12.3 -0.252 ## 10 10 Delaware 16.7 19.9 -3.18 ## # … with 42 more rows "],["exporting-r-objects.html", "10 Exporting R Objects 10.1 Exporting a single object 10.2 Exporting multiple objects", " 10 Exporting R Objects 10.1 Exporting a single object 10.1.1 Exporting a single dataset to disk as a CSV file write_csv(state_population_2010, &quot;state_population_2010.csv&quot;) Figure 10.1: ‘state_population_2010’ exported as CSV file to working directory write_csv(state_population_2010, &quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/exported_datasets/state_population_2010.csv&quot;) Figure 10.2: ‘state_population_2010’ exported as CSV file to dedicated directory named ’exported_datasets 10.1.2 Exporting a single map to disk as a png, jpeg, or PDF file with tmap_save median_age_CO_map tmap_save(median_age_CO_map, &quot;median_age_CO_map.png&quot;) ## Map saved to /Users/adra7980/Documents/git_repositories/R_census/median_age_CO_map.png ## Resolution: 2448.944 by 1800.776 pixels ## Size: 8.163147 by 6.002587 inches (300 dpi) Figure 10.3: Colorado median age map exported to working directory as png file tmap_save(median_age_CO_map, &quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/median_age_CO_map.pdf&quot;) ## Map saved to /Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/median_age_CO_map.pdf ## Size: 8.152778 by 6 inches Figure 10.4: Colorado median age map exported to dedicated directory as PDF file 10.1.3 Exporting a single ggplot visualization to disk as a png, jpeg, or PDF file with “ggsave” median_age_CO_cleaned_visualization ggsave(&quot;CO_median_age_graph.png&quot;, median_age_CO_cleaned_visualization) ## Saving 7 x 5 in image Figure 10.5: Colorado median age map graph exported to working directory as png file ggsave(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/CO_median_age_graph.jpeg&quot;, median_age_CO_cleaned_visualization) ## Saving 7 x 5 in image Figure 10.6: Colorado median age map graph exported to dedicated directory as jpeg file 10.1.4 Exporting a single ggplot or tmap visualization with a graphics device Exporting a single tmap visualization as a pdf file using a pdf device pdf(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/CO_median_age_map.pdf&quot;) median_age_CO_map dev.off() ## quartz_off_screen ## 2 Exporting a single tmap visualization as a png file using a png device png(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/CO_median_age_map.png&quot;) median_age_CO_map dev.off() ## quartz_off_screen ## 2 Exporting a single ggplot visualization as a jpeg file using a jpeg device jpeg(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/CO_median_age_graph.jpeg&quot;) median_age_CO_cleaned_visualization dev.off() ## quartz_off_screen ## 2 10.2 Exporting multiple objects 10.2.1 Exporting multiple csv files stored in a list population_rural_2000_2010_list_cleaned ## $`2000` ## # A tibble: 52 x 3 ## GEOID NAME rural_pct_2000 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 01 Alabama 44.6 ## 2 02 Alaska 34.4 ## 3 04 Arizona 11.8 ## 4 05 Arkansas 47.5 ## 5 06 California 5.56 ## 6 08 Colorado 15.5 ## 7 09 Connecticut 12.3 ## 8 10 Delaware 19.9 ## 9 11 District of Columbia 0 ## 10 12 Florida 10.7 ## # … with 42 more rows ## ## $`2010` ## # A tibble: 52 x 3 ## GEOID NAME rural_pct_2010 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 01 Alabama 41.0 ## 2 02 Alaska 34.0 ## 3 04 Arizona 10.2 ## 4 05 Arkansas 43.8 ## 5 06 California 5.05 ## 6 22 Louisiana 26.8 ## 7 21 Kentucky 41.6 ## 8 08 Colorado 13.8 ## 9 09 Connecticut 12.0 ## 10 10 Delaware 16.7 ## # … with 42 more rows writeout_function&lt;-function(object, filename){ setwd(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/exported_datasets&quot;) filename&lt;-paste0(filename, &quot;.csv&quot;) write_csv(object, filename) } filename_vector&lt;-paste0(&quot;rural_pct_&quot;, names(population_rural_2000_2010_list_cleaned)) filename_vector ## [1] &quot;rural_pct_2000&quot; &quot;rural_pct_2010&quot; walk2(population_rural_2000_2010_list_cleaned, filename_vector, writeout_function) Figure 10.7: Rural pct by state, for 2000 and 2010, exported to dedicated directory as CSV files 10.2.2 Exporting multiple csv files stored as separate objects in the global environment state_total_2010&lt;-get_decennial(geography=&quot;state&quot;, variables = &quot;P001001&quot;, year = 2010) ## Getting data from the 2010 decennial Census ## Using Census Summary File 1 state_rural_2010&lt;-get_decennial(geography = &quot;state&quot;, variables = &quot;P002005&quot;, year = 2010) ## Getting data from the 2010 decennial Census ## Using Census Summary File 1 # put objects to export in a named list objects_to_export&lt;-lst(state_total_2010, state_rural_2010) # create filename vector filename_vector&lt;-names(objects_to_export) # write out census datasets as CSV files walk2(objects_to_export, filename_vector, writeout_function) Figure 10.8: ‘state_total_2010, and ’state_rural_2010’, exported to dedicated directory as CSV files 10.2.3 Using a graphics device to export multiple objects from a list into a single PDF file Use PDF viewer to write out multiple tmap visualizations stored in a list to a single PDF file pdf(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/age_maps.pdf&quot;) county_age_maps_list ## $NM ## ## $UT ## ## $AZ ## ## $WY dev.off() ## quartz_off_screen ## 2 Use PDF viewer to write out multiple ggplot visualizations stored in a list to a single PDF file pdf(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations/age_graphs.pdf&quot;) county_age_graphs_list ## $NM ## ## $UT ## ## $AZ ## ## $WY dev.off() ## quartz_off_screen ## 2 Figure 10.9: All of the graphs in county_age_graphs_list written to a single PDF file, and all of the maps in county_age_maps_list written to a single PDF file; the displayed file is the first graph in county_age_graphs_list, depicting the median age in New Mexico counties 10.2.4 Writing out multiple “tmap” or “ggplot” objects as separate files viz_save_general&lt;-function(plot, filename, extension){ setwd(&quot;/Users/adra7980/Documents/git_repositories/R_census/exported_objects/visualizations&quot;) filename_string&lt;-paste0(filename, extension) if(extension==&quot;.pdf&quot;){ pdf(filename_string) } else { if (extension==&quot;.png&quot;){ png(filename_string) } else { if (extension==&quot;.jpeg&quot;){ jpeg(filename_string) } } } print(plot) dev.off() } # writes out tmap objects from &quot;county_age_maps_list&quot; as separate jpeg files filenames&lt;-paste0(names(county_age_maps_list), &quot;_&quot;, &quot;COUNTY_AGE_MAP&quot;) inputlist&lt;-list(county_age_maps_list, filenames, &quot;.jpeg&quot;) pwalk(inputlist, viz_save_general) Figure 10.10: The four tmap elements in the county_age_maps_list, written out to a dedicated directory as separate jpeg files If you want PDFs of the maps in ```county_age_maps_list\", then… # writes out tmap objects from &quot;county_age_maps_list&quot; as separate PDF files filenames&lt;-paste0(names(county_age_maps_list), &quot;_&quot;, &quot;COUNTY_AGE_MAP&quot;) inputlist&lt;-list(county_age_maps_list, filenames, &quot;.pdf&quot;) pwalk(inputlist, viz_save_general) Figure 10.11: The four tmap elements in the county_age_maps_list, written out to a dedicated directory as separate PDF files We can use the same function (viz_save_general) to write out ggplot objects as separate files with a specified file extension. For example, to write out the graphs in county_age_graphs_list as png files: filenames&lt;-paste0(names(county_age_graphs_list), &quot;_&quot;, &quot;COUNTY_AGE_GRAPH&quot;) inputlist&lt;-list(county_age_graphs_list, filenames, &quot;.png&quot;) pwalk(inputlist, viz_save_general) Figure 10.12: The four ggplot elements in the county_age_graphs_list, written out to a dedicated directory as separate png files To write out the graphs in county_age_graphs_list as pdf or jpeg files, simply modify the file extensions: # Writes out elements in &quot;county_age_graphs_list&quot; as separate pdf files filenames&lt;-paste0(names(county_age_graphs_list), &quot;_&quot;, &quot;COUNTY_AGE_GRAPH&quot;) inputlist&lt;-list(county_age_graphs_list, filenames, &quot;.pdf&quot;) pwalk(inputlist, viz_save_general) # Writes out elements in &quot;county_age_graphs_list&quot; as separate jpeg files filenames&lt;-paste0(names(county_age_graphs_list), &quot;_&quot;, &quot;COUNTY_AGE_GRAPH&quot;) inputlist&lt;-list(county_age_graphs_list, filenames, &quot;.jpeg&quot;) pwalk(inputlist, viz_save_general) "],["acs-data-retrieval.html", "11 ACS Data Retrieval", " 11 ACS Data Retrieval "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
